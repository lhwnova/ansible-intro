--- # Copy ssh file 
- hosts: all
  remote_user: root
  become: yes
  become_method: sudo
  connection: ssh
  gather_facts: no
  tasks:
  #- name: Check for .ssh 
   # stat: path=/root/.ssh
    #register: p

  - name: creat directory if not exist 
    file:
     path: /root/.ssh
     state: directory
     mode: 0755
     #when: not p.stat.exists

  - name: copying file to remote host
    copy:
     src: /root/.ssh/newkey.pub
     dest: /root/.ssh/
     owner: root
     group: root
     mode: 0644

  - name: Set authorized key took from file
    authorized_key:
     user: root
     state: present
     key: "{{ lookup('file', '/root/.ssh/newkey.pub') }}"

 

